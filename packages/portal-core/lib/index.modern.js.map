{"version":3,"file":"index.modern.js","sources":["../src/dataProvider/DataProviderContext.tsx","../src/store/index.ts","../src/core/CorePortalContext.tsx","../src/core/CorePortalRouter.tsx","../src/core/PortalSite.tsx","../src/hooks/useDataProvider.ts","../src/hooks/useQueryList.ts","../src/hooks/useRoutesMap.ts","../src/hooks/useQueryOne.ts","../src/router/PortalLink.tsx","../src/router/PortalRoute.tsx"],"sourcesContent":["import { createContext } from 'react';\n\nexport type Response = {\n    code: number;\n    loaded: boolean;\n    loading: boolean;\n    error: any;\n};\nexport type ItemResponse = Response & {\n    data: any;\n};\nexport type ListResponse = Response & {\n    records: any[];\n    total: number;\n    pages: number;\n    page: number;\n};\nexport type DataProviderMethod<T> = (arg: any, ...rest: any[]) => Promise<T>;\n// export type DataProvider = {\n//   [method: string]: DataProviderMethod<any>;\n// };\n\nexport interface DataProvider {\n    [method: string]: (arg: any, ...rest: any[]) => Promise<any>;\n}\n\nconst DataProviderContext = createContext<DataProvider>({});\n\nDataProviderContext.displayName = 'DataProviderContext';\n\nexport default DataProviderContext;\n","import mpa from '@mpfe/mpa';\r\nimport { Model } from '@mpfe/mpa/lib/type';\r\n\r\nfunction createModels(\r\n  models: Array<Function>,\r\n  dataProvider: any\r\n): Array<Model> {\r\n  return models.map((model) => model(dataProvider));\r\n}\r\n\r\nconst coreStore = mpa({ silence: true });\r\nexport { coreStore, createModels };\r\n","import React, { FunctionComponent, ReactNode } from 'react';\nimport DataProviderContext, { DataProvider } from '../dataProvider/DataProviderContext';\nimport { Provider } from 'react-redux';\nimport { coreStore, createModels } from '../store';\nexport interface CorePortalContextProps {\n    dataProvider: DataProvider;\n    children: ReactNode;\n    models: any[];\n    store?: any;\n}\n\nconst CorePortalContext: FunctionComponent<CorePortalContextProps> = ({\n    dataProvider,\n    children,\n    models = [],\n    store\n}) => {\n    coreStore.useModel(...createModels(models, dataProvider));\n    coreStore.run();\n    return (\n        <Provider store={store || coreStore.store}>\n            <DataProviderContext.Provider value={dataProvider}>\n                {children}\n            </DataProviderContext.Provider>\n        </Provider>\n    );\n};\nexport default CorePortalContext;\n","import React, { useEffect, FunctionComponent } from 'react';\nimport { coreStore } from '../store';\nimport { Router } from 'react-router-dom';\nimport { History } from 'history';\n\nconst CorePortalRouter: FunctionComponent<{\n    children: any;\n    root: string;\n    history: History;\n}> = ({ children, root, history }) => {\n    useEffect(() => {\n        coreStore.store.dispatch(coreStore.actions('routesMap').getRoutes(root));\n    }, [root]);\n\n    return <Router history={history}>{children}</Router>;\n};\n\nexport default CorePortalRouter;\n","import React, { FunctionComponent } from 'react';\nimport CorePortalContext from './CorePortalContext';\nimport CorePortalRouter from './CorePortalRouter';\n// import { DataProvider } from '../dataProvider/DataProviderContext';\nimport { History } from 'history';\n\nexport interface PortalSiteProps {\n    dataProvider: any;\n    models?: any[];\n    history: History;\n    basename?: string;\n    root: string;\n    store?: any;\n}\n\nconst PortalSite: FunctionComponent<PortalSiteProps> = ({\n    children,\n    dataProvider,\n    models = [],\n    history,\n    root,\n    store\n}) => {\n    return (\n        <CorePortalContext store={store} models={models} dataProvider={dataProvider}>\n            <CorePortalRouter root={root} history={history}>\n                {children}\n            </CorePortalRouter>\n        </CorePortalContext>\n    );\n};\nexport default PortalSite;\n","import { useContext } from 'react';\nimport DataProviderContext, { DataProviderMethod } from '../dataProvider/DataProviderContext';\n\nfunction useDataProvider<T>(method: string): DataProviderMethod<T> {\n    const dataProvider = useContext(DataProviderContext);\n    return dataProvider[method];\n}\n\nexport default useDataProvider;\n","import { useEffect, useState } from 'react';\nimport useDataProvider from './useDataProvider';\nimport { ListItem } from '@portal-site/types';\nimport { ListResponse, DataProviderMethod } from '../dataProvider/DataProviderContext';\nconst useQueryList = (\n    resource: string,\n    page: number,\n    size: number,\n    onSuccess?: (arg: any) => any,\n    onFailure?: (arg: any) => any\n): {\n    records: Array<ListItem>;\n    total?: number;\n    error: any;\n    loading: boolean;\n    loaded: boolean;\n    pages: number;\n    page: number;\n} => {\n    const dataProvider: DataProviderMethod<ListResponse> = useDataProvider('queryList');\n    const [state, setState] = useState<{\n        records: any[];\n        error: any;\n        loading: boolean;\n        loaded: boolean;\n        total: number;\n        pages: number;\n        page: number;\n    }>({\n        records: [],\n        total: 0,\n        error: null,\n        loading: true,\n        loaded: false,\n        pages: 0,\n        page: 1\n    });\n    useEffect(() => {\n        setState((prevState) => {\n            return {\n                ...prevState,\n                loading: true\n            };\n        });\n        dataProvider({ resource, page, size })\n            .then((data) => {\n                onSuccess && onSuccess(data);\n                setState({\n                    ...data,\n                    loaded: true,\n                    error: null,\n                    loading: false\n                });\n            })\n            .catch((error) => {\n                onFailure && onFailure(error);\n                setState({\n                    error,\n                    loading: false,\n                    loaded: false,\n                    records: [],\n                    total: 0,\n                    pages: 0,\n                    page: 0\n                });\n            });\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [resource, page]);\n    return state;\n};\n\nexport default useQueryList;\n","import { useSelector } from 'react-redux';\nimport { IRootRouteMap } from '@portal-site/types';\nconst useRoutesMap = (): IRootRouteMap => {\n    const routesMap = useSelector((state: any) => state.routesMap.root);\n    return routesMap;\n};\n\nexport default useRoutesMap;\n","import { useEffect, useState } from 'react';\nimport { ListItem } from '@portal-site/types';\nimport useDataProvider from './useDataProvider';\nimport { ItemResponse } from '../dataProvider/DataProviderContext';\n\nconst useQueryOne = (\n    resource: string,\n    path?: string\n): {\n    loading: boolean;\n    loaded: boolean;\n    data: ListItem | { [prop: string]: any };\n    error?: any;\n} => {\n    const dataProvider = useDataProvider<ItemResponse>('queryOneById');\n    const [state, setState] = useState({\n        loading: true,\n        loaded: false,\n        data: {},\n        error: null\n    });\n    useEffect(() => {\n        setState({\n            data: {},\n            loaded: false,\n            loading: true,\n            error: null\n        });\n        dataProvider(resource, path)\n            .then((data) => {\n                setState({\n                    ...data,\n                    loaded: true,\n                    loading: false,\n                    error: null\n                });\n            })\n            .catch((err) => {\n                setState({\n                    data: {},\n                    loaded: false,\n                    loading: false,\n                    error: err\n                });\n            });\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [resource]);\n    console.log(state);\n    return state;\n};\n\nexport default useQueryOne;\n","import React from 'react';\r\nimport { LinkProps, Link } from 'react-router-dom';\r\nimport { FunctionComponent } from 'react';\r\n\r\nexport interface PortalLinkProps extends LinkProps {\r\n    href?: string;\r\n}\r\n\r\nconst PortalLink: FunctionComponent<PortalLinkProps> = ({ href, children, to, ...rest }) => {\r\n    if (typeof href === 'string') {\r\n        return (\r\n            <a rel=\"noopener noreferrer\" href={href} {...rest}>\r\n                {children}\r\n            </a>\r\n        );\r\n    }\r\n    return (\r\n        <Link to={to} {...rest}>\r\n            {children}\r\n        </Link>\r\n    );\r\n};\r\nexport default PortalLink;\r\n","import React from 'react';\r\nimport { Route, RouteProps, matchPath, useLocation } from 'react-router-dom';\r\nimport { FunctionComponent } from 'react';\r\nexport interface PortalRouteProps extends RouteProps {\r\n    exclude: Array<string> | string;\r\n}\r\n\r\nconst PortalRoute: FunctionComponent<PortalRouteProps> = ({ exclude, path, ...rest }) => {\r\n    const matchAll = path === '*';\r\n    if (exclude && !matchAll) {\r\n        console.warn(\"The prop 'exclude' could only be used when path is '*' \");\r\n    }\r\n\r\n    const excludePaths = exclude ? (Array.isArray(exclude) ? exclude : [exclude]) : null;\r\n    const location = useLocation();\r\n    // 如果exclude 匹配了当前路径\r\n    const match = excludePaths && excludePaths.some((path) => matchPath(path, location.pathname));\r\n    if (match) return null;\r\n    return <Route path={path} {...rest}></Route>;\r\n};\r\n\r\nexport default PortalRoute;\r\n"],"names":["DataProviderContext","createContext","displayName","createModels","models","dataProvider","map","model","coreStore","mpa","silence","CorePortalContext","children","store","useModel","run","React","Provider","value","CorePortalRouter","root","history","useEffect","dispatch","actions","getRoutes","Router","PortalSite","useDataProvider","method","useContext","useQueryList","resource","page","size","onSuccess","onFailure","state","setState","useState","records","total","error","loading","loaded","pages","prevState","then","data","catch","useRoutesMap","routesMap","useSelector","useQueryOne","path","err","console","log","PortalLink","href","to","rest","rel","Link","PortalRoute","exclude","matchAll","warn","excludePaths","Array","isArray","location","useLocation","match","some","matchPath","pathname","Route"],"mappings":"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"}